var o,h;const l=((h=(o=import.meta)==null?void 0:o.env)==null?void 0:h.VITE_API_BASE_URL)||"http://localhost:4000",m={baseURL:l,tokenKey:"ecommerce_token",get token(){try{return JSON.parse(localStorage.getItem(this.tokenKey))}catch{return null}},set token(e){e?localStorage.setItem(this.tokenKey,JSON.stringify(e)):localStorage.removeItem(this.tokenKey)},async request(e,{method:t="GET",body:s,auth:a=!1}={}){const r={"Content-Type":"application/json"};a&&this.token&&(r.Authorization=`Bearer ${this.token}`);const n=await fetch(`${this.baseURL}${e}`,{method:t,headers:r,body:s?JSON.stringify(s):void 0}),i=await n.json().catch(()=>({}));if(!n.ok){const u=(i==null?void 0:i.message)||`HTTP ${n.status}`;throw new Error(u)}return i},register({name:e,email:t,password:s}){return this.request("/api/auth/register",{method:"POST",body:{name:e,email:t,password:s}})},login({email:e,password:t}){return this.request("/api/auth/login",{method:"POST",body:{email:e,password:t}})},getItems(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([a,r])=>{r!=null&&r!==""&&t.append(a,Array.isArray(r)?r.join(","):r)});const s=t.toString()?`?${t.toString()}`:"";return this.request(`/api/items${s}`)},getItem(e){return this.request(`/api/items/${e}`)},getCart(){return this.request("/api/cart",{auth:!0})},replaceCart(e){return this.request("/api/cart",{method:"PUT",body:{items:e},auth:!0})},addToCart(e,t=1){return this.request("/api/cart/add",{method:"POST",body:{itemId:e,qty:t},auth:!0})},updateCartItem(e,t){return this.request(`/api/cart/${e}`,{method:"PATCH",body:{qty:t},auth:!0})},removeCartItem(e){return this.request(`/api/cart/${e}`,{method:"DELETE",auth:!0})},async resolveItemIdByProduct(e){const t=(e==null?void 0:e.name)||(e==null?void 0:e.title)||"",s=(e==null?void 0:e.image)||"",{items:a}=await this.getItems({q:t});let r=a==null?void 0:a.find(n=>n.image===s&&n.title.toLowerCase()===t.toLowerCase());return r||(r=a==null?void 0:a.find(n=>n.title.toLowerCase()===t.toLowerCase())),!r&&s&&(r=a==null?void 0:a.find(n=>n.image===s)),(r==null?void 0:r.id)||null}};export{m as API};
